

# Discord 服薬リマインダーBOT

アロナちゃんが服薬管理のために指定した時間に指定したチャンネルと複数のユーザーにメンションをかけ説教するBOTです。Google Gemini APIと連携し、毎日異なる励ましのメッセージを生成するほか、服薬状況をカレンダーで視覚的に管理できます。
config-default.yamlをコピーしconfig.yamlとしてください。

## ✨ 主な機能

- **定時リマインド機能**: `config.yaml`で設定した時間に、まだ服薬していないユーザー全員にメンション通知を送信します。
- **Gemini連携**: Google Gemini APIを利用して、毎日ユニークで心温まるメッセージを自動生成します。
- **GIF投稿機能**: 通知メッセージにランダムなGIFを添付し、コミュニケーションを豊かにします。
- **服薬カレンダー**:
    - ユーザーごとに服薬状況を記録・管理します。
    - 絵文字を使って、服薬済み（✅）、今日（🗓️）、飲み忘れ（⚠️）を分かりやすく表示します。
- **マルチユーザー対応**: 複数のユーザーの服薬状況を個別に管理できます。
- **スラッシュコマンド**: 直感的なスラッシュコマンドで、BOTの全機能を操作できます。
    - `/med`: 服薬を記録します。
    - `/check`: 服薬カレンダーを確認します。
    - `/uncheck`: その日の服薬記録を取り消します。
    - `/notice`: 任意のタイミングで、未服薬者全員に公開通知を送信します。
    - `/test_notice`: 自分だけにテスト通知を送信し、表示を確認できます。

## 🔧 動作要件

- Python 3.8 以降
- 必要なライブラリ (詳細は `requirements.txt` を参照)
- Discord Bot Token
- Google Gemini API Key (任意)

## 🚀 セットアップ方法

### 1. リポジトリのクローン

```bash
git clone <リポジトリのURL>
cd <リポジトリのディレクトリ>
```

### 2. 必要なライブラリのインストール

以下のコマンドで、必要なPythonライブラリをインストールします。

```bash
pip install -r requirements.txt
```

`requirements.txt` ファイルがない場合は、以下の内容で作成してください。

**`requirements.txt`**:
```txt
py-cord
pyyaml
pytz
google-generativeai```

### 3. 設定ファイルの作成

`config.yaml` という名前で設定ファイルを作成し、以下の内容を参考に編集します。

**`config.yaml`**:
```yaml
# Discord BOTのトークン
token: "YOUR_DISCORD_BOT_TOKEN"

# 通知を送信するチャンネルのID
channel_id: 123456789012345678

# BOTのステータスメッセージ
status_message: "お薬の時間だよ"

# 通知時のメンションに続くメッセージ
message: "先生、お薬の時間です。"

# 定期通知を送信する時間 (JST, 24時間表記)。複数指定可能
notify_times:
  - "08:00"
  - "20:00"

# --- 管理対象のユーザーリスト ---
# 複数人登録する場合は、同じ形式で追記してください
target_users:
  - id: 111111111111111111 # ユーザーAのDiscord ID
    name: "User A" # 設定ファイルを見やすくするための名前
  - id: 222222222222222222 # ユーザーBのDiscord ID
    name: "User B"

# --- Gemini API 設定 ---
# Gemini APIキー
gemini_api_key: "YOUR_GEMINI_API_KEY"

# 使用するモデル名 (任意, デフォルトは 'gemini-pro')
gemini_model_name: 'gemini-pro'

# Geminiに与えるシステムプロンプト (BOTのキャラクター設定)
system_prompt: "あなたは、とある患者の健康を管理している、少しお茶目な看護師です。相手を「先生」と呼び、親しみやすくも、時に厳しく服薬を促します。丁寧な言葉遣いを基本としますが、ユーモアを忘れないでください。"

# --- GIF設定 (任意) ---
# 通知時にランダムで表示するGIFのURLリスト
gif_urls:
  - "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjEx.../giphy.gif"
  - "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjEx.../giphy.gif"
```

**各種IDの取得方法:**
- **Discord ID (ユーザーID, チャンネルID)**: Discordの設定で「開発者モード」をオンにした後、対象のユーザーやチャンネルを右クリックして「IDをコピー」を選択します。

### 4. BOTの起動

設定が完了したら、以下のコマンドでBOTを起動します。

```bash
python main.py
```

コンソールに「(BOT名) としてログインしました。」と表示されれば成功です。

## 📖 コマンド一覧

### `/med <user>`
指定したユーザーが薬を飲んだことを記録します。
- **user**: 服薬を記録する対象のユーザーを `@メンション` で指定します。
- 実行すると、更新されたカレンダーが表示されます。

### `/check <user>`
指定したユーザーの現在の服薬カレンダーを表示します。
- **user**: 状況を確認したいユーザーを `@メンション` で指定します。
- その日の服薬状況に応じたメッセージが表示されます。

### `/uncheck <user>`
指定したユーザーの**今日**の服薬記録を取り消します。
- **user**: 記録を取り消したいユーザーを `@メンション` で指定します。
- 間違えて `/med` を実行してしまった場合に使用します。

### `/notice`
未服薬のユーザー全員に、公開の通知を送信します。
- 定期通知と同じ内容（メンション、Geminiメッセージ、GIF、カレンダー）が即座に送信されます。
- コマンドの実行結果は、実行者本人にのみ表示されます。

### `/test_notice`
コマンド実行者本人にのみ、テスト通知を送信します。
- **他の人には見えません。**
- 通知がどのように表示されるかを確認するのに便利です。

## 📁 自動生成されるファイル

- **`medication_log.json`**: ユーザーごとの服薬記録が保存されるJSONファイルです。BOTが自動で生成・管理するため、手動で編集する必要はありません。

## 📜 ライセンス

このプロジェクトは [MITライセンス](LICENSE) の下で公開されています。